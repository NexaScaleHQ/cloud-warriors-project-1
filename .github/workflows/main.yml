name: "Terraform"

on:
 push:
  branches:
   - main

jobs:
   terraform:
    name: "Terraform"
    runs-on: ubuntu-latest
    env:
      AWS_ACCESS_KEY_ID: "AKIAWBPQPR5DOM6HKGUP"
      AWS_SECRET_ACCESS_KEY: "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"
      AWS_REGION: "eu-west-1"
    defaults:
     run:
      working-directory: .
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v1
      with: 
       terraform_version: 1.0.1
       terraform_wrapper: false

    - name: Terraform Format
      id: fmt
      run: terraform fmt -check

    - name: Terraform Init
      id: init
      run: terraform init        

    - name: Terraform Plan
      id: plan
      run: terraform plan -no-color

    - name: Terraform Apply
      id: apply
      run: terraform apply -auto-approve     
    
